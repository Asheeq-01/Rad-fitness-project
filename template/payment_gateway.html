{% extends 'base.html' %}
{% block content %}
<style>
    :root {
        --gym-orange: #ff5f00;
        --gym-dark: #111111;
        --security-blue: #0ea5e9;
    }

    .payment-body {
        background-color: #f8fafc;
        min-height: 80vh;
        display: flex;
        align-items: center;
    }

    .payment-card {
        background: white;
        border-radius: 30px;
        border: none;
        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.1);
        padding: 60px 40px;
        max-width: 500px;
        margin: auto;
    }

    .shield-icon {
        width: 80px;
        height: 80px;
        background: rgba(14, 165, 233, 0.1);
        color: var(--security-blue);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 25px;
        font-size: 2.5rem;
    }

    .spinner-custom {
        width: 3rem;
        height: 3rem;
        border: 4px solid var(--gym-orange);
        border-right-color: transparent;
        margin-bottom: 20px;
    }

    .payment-status-text {
        font-weight: 800;
        color: var(--gym-dark);
        letter-spacing: -0.5px;
        margin-bottom: 8px;
    }

    .order-ref {
        background: #f1f5f9;
        padding: 8px 15px;
        border-radius: 10px;
        font-family: 'Courier New', Courier, monospace;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .pay-btn-main {
        background: var(--gym-dark);
        color: white;
        border: none;
        padding: 18px;
        border-radius: 15px;
        width: 100%;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: 0.3s;
        margin-top: 30px;
    }

    .pay-btn-main:hover {
        background: var(--gym-orange);
        transform: translateY(-2px);
    }
</style>

<div class="payment-body">
    <div class="container">
        <div class="payment-card text-center">
            <div class="shield-icon">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            
            <div class="spinner-border spinner-custom" role="status"></div>
            
            <h3 class="payment-status-text">INITIALIZING SECURE GATEWAY</h3>
            <p class="text-muted mb-4 small">Securely connecting to Razorpay Servers...</p>
            
            <div class="mb-2">
                <span class="text-muted small uppercase fw-bold">Order Reference:</span><br>
                <span class="order-ref">{{ order.order_id }}</span>
            </div>

            <button id="rzp-button1" class="pay-btn-main">
                Complete Payment â‚¹{{ total }}
            </button>
            
            <p class="mt-4 mb-0 small text-muted">
                <i class="fa-solid fa-lock me-1"></i> 256-bit SSL Encrypted Payment
            </p>
        </div>
    </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    const options = {
        "key": "{{ razorpay_key }}",
        "amount": "{{ payment.amount }}", 
        "currency": "INR",
        "name": "Elite Fitness Store",
        "description": "Premium Gym Equipment",
        "image": "https://your-logo-url.com/logo.png", // Add your gym logo here
        "order_id": "{{ payment.id }}", 
        "handler": function (response){
            // Success: Send to backend for confirmation
            window.location.href = "{% url 'paymentsuccess' %}?order_id={{ order.order_id }}&payment_id=" + response.razorpay_payment_id + "&signature=" + response.razorpay_signature;
        },
        "prefill": {
            "name": "{{ request.user.first_name }} {{ request.user.last_name }}",
            "email": "{{ request.user.email }}",
            "contact": "{{ order.phone }}" 
        },
        "notes": {
            "address": "{{ order.address }}"
        },
        "theme": {
            "color": "#ff5f00"
        }
    };

    const rzp1 = new Razorpay(options);

    // Handling payment failure
    rzp1.on('payment.failed', function (response){
        alert("Payment Failed: " + response.error.description);
    });

    document.getElementById('rzp-button1').onclick = function(e){
        rzp1.open();
        e.preventDefault();
    }

    // Auto-launch the payment window after a 1.5s delay for realistic feel
    window.onload = function() {
        setTimeout(() => {
            rzp1.open();
        }, 1500);
    };
    console.log("KEY:", "{{ razorpay_key }}");

</script>
{% endblock %}